{% extends 'base.html' %}
{% block title %}萌娘百科的更新姬-推送状态{% endblock %}
{% block scripts %}
{{ super() }}
<script type='text/javascript'>
function refreshmodalsuccess(){
    var success="<div class='text-center'><span class='glyphicon glyphicon-ok' aria-hidden='true' font-size='50px'></span></div><p class='lead text-center'>操作成功</p><br /><div class='text-center'><small>条目将在下一次推送时被推送</small>"
    document.getElementById('ModalContent').innerHTML=success
}
function refreshmodalerror(){
    var error="<div class='text-center'><span class='glyphicon glyphicon-remove' aria-hidden='true' font-size='50px'></span></div><p class='lead text-center'>错误－请检查本日剩余条目推送次数或条目不符合推送标准</p>"
    document.getElementById('ModalContent').innerHTML=error
}
var csrftoken = "{{ csrf_token() }}"
function btnclick(id){
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken)
            }
            }
        })
    var PostVal={"title":id}
    $.ajax({type:'POST',contentType:'application/json',url:'update',data:JSON.stringify(PostVal),success:refreshmodalsuccess,error:refreshmodalerror})
}
 $(function() { $('#loadingModal').on('hide.bs.modal', function() {location.reload()})})
</script>
{% endblock %}
{% block mainbody %}
<div class='col-md-8'>
    <table class='table table-hover'>
        <tr>
            <th class=col-md-1>序号</th>
            <th class='col-md-8'>词条名</th>
            <th>优先推送</th>
        </tr>
        {% for title in title %}
        <tr>
            <th>{{ loop.index }}</th>
            <th><p>{{ title }}</p></th>
            <th> <button class='btn btn-default' id='{{title}}' value='push' data-toggle='modal' data-target='#loadingModal' onclick='btnclick(this.id)'>推送</button></th>
        </tr>
        {% endfor %}
</div>
<div class='modal fade' id='loadingModal' tabindex='-1' role='dialog' aria-labelledby='loadingModalLabel'>
    <div class='modal-dialog' role='alertdialog'>
        <div class='modal-content'>
            <div class='modal-header'>
                <button type='button' class='close' data-dismiss='modal' aria-labal='close'><span aria-hidden='true'>&times;</span></button>
                <h4 class='modal-title' id='loadingModalLabel'>处理中</h4>
            </div>
            <div class='modal-body'>
                    <div class='text-center' id='ModalContent'>
                        <p>正在处理推送，请稍后</p>
                    </div>
            </div>
{% endblock %}
